---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import type { MarkdownHeading } from "astro";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content, headings } = await post.render();

// TODO: process nested headings
---

<Layout title={post.title}>
  <article class="py-20">
    <section class="desktop:fixed desktop:left-8 desktop:w-[20vw]">
      <h1>{post.data.title}</h1>
      <p>
        {post.data.pubDate.toLocaleDateString("en-AU")}
      </p>
      {
        headings.length > 0 && (
          <details open class="group hidden desktop:block">
            <summary class="inline-block cursor-pointer after:inline-block after:pl-1 after:align-text-bottom after:transition-transform after:content-['►'] group-open:after:rotate-90">
              <h3 class="inline cursor-pointer">Contents</h3>
            </summary>
            <ul>
              {headings.map((heading: MarkdownHeading) => (
                <li>
                  <a href={`#${heading.slug}`}>{heading.text}</a>
                </li>
              ))}
            </ul>
          </details>
        )
      }
      <section class="my-4">
        <a href="/">← Home</a>
      </section>
    </section>
    <Content />
    <section class="desktop:hidden">
      <a href="/">← Home</a>
    </section>
  </article>
</Layout>
